<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Profesores</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark text-light">
    <div class="container mt-5">
        <h1 class="text-center mb-4">👨‍🏫 Gestión de Profesores</h1>

        <!-- LISTADO -->
        <h4 class="text-light">Listado de Profesores</h4>
        <table class="table table-bordered table-hover table-dark">
            <thead class="table-light text-dark">
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Especialidad</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody id="tabla-profesores"></tbody>
        </table>

        <hr class="border-light">

        <!-- FORMULARIO -->
        <h4 class="text-light mt-4">Formulario de Profesor</h4>
        <form id="form-profesor" class="bg-secondary p-4 rounded">
            <input type="hidden" id="profesorId">
            <div class="mb-3">
                <label for="nombre" class="form-label">Nombre del Profesor</label>
                <input type="text" class="form-control" id="nombre" required>
            </div>
            <div class="mb-3">
                <label for="especialidad" class="form-label">Especialidad</label>
                <input type="text" class="form-control" id="especialidad" required>
            </div>
            <button type="submit" class="btn btn-primary w-100">Guardar Profesor</button>
        </form>
        <div id="mensaje" class="mt-4 text-center"></div>
    </div>

    <script>
        async function cargarProfesores() {
            const tabla = document.getElementById('tabla-profesores');
            tabla.innerHTML = "";
            try {
                const profesores = await fetch('/api/profesores').then(res => res.json());
                profesores.forEach(p => {
                    const fila = document.createElement('tr');
                    fila.innerHTML = `
                            <td>${p.id}</td>
                            <td>${p.nombre}</td>
                            <td>${p.especialidad}</td>
                            <td>
                                <button class="btn btn-sm btn-warning me-2" onclick="editarProfesor(${p.id})">✏️</button>
                                <button class="btn btn-sm btn-danger" onclick="eliminarProfesor(${p.id})">🗑</button>
                            </td>
                        `;
                    tabla.appendChild(fila);
                });
            } catch (error) {
                console.error("Error al cargar profesores:", error);
            }
        }

        document.getElementById('form-profesor').addEventListener('submit', async function (e) {
            e.preventDefault();
            const id = document.getElementById('profesorId').value;
            const nombre = document.getElementById('nombre').value;
            const especialidad = document.getElementById('especialidad').value;

            const body = JSON.stringify({ id, nombre, especialidad });
            const mensaje = document.getElementById('mensaje');

            try {
                const response = await fetch(`/api/profesores${id ? `/${id}` : ''}`, {
                    method: id ? 'PUT' : 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: body
                });

                if (response.ok) {
                    mensaje.innerHTML = `<div class="alert alert-success">Profesor ${id ? 'actualizado' : 'registrado'} correctamente ✅</div>`;
                    this.reset();
                    cargarProfesores();
                } else {
                    mensaje.innerHTML = `<div class="alert alert-danger">Error al ${id ? 'actualizar' : 'registrar'} el profesor ❌</div>`;
                }
            } catch (error) {
                console.error("Error al guardar profesor:", error);
            }
        });

        async function eliminarProfesor(id) {
            if (!confirm("¿Deseas eliminar este profesor?")) return;

            try {
                const response = await fetch(`/api/profesores/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    alert("Profesor eliminado correctamente ✅");
                    cargarProfesores();
                } else {
                    alert("Error al eliminar profesor ❌");
                }
            } catch (error) {
                console.error("Error al eliminar profesor:", error);
            }
        }

        async function editarProfesor(id) {
            try {
                const profesor = await fetch(`/api/profesores/${id}`).then(res => res.json());

                document.getElementById('profesorId').value = profesor.id;
                document.getElementById('nombre').value = profesor.nombre;
                document.getElementById('especialidad').value = profesor.especialidad;
            } catch (error) {
                console.error("Error al cargar profesor para edición:", error);
            }
        }

        cargarProfesores();
    </script>
</body>
</html>
